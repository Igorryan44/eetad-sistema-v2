<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corre√ß√£o Final - Sistema de Login</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .warning {
            color: #ff9800;
            font-weight: bold;
        }
        .info {
            color: #2196F3;
        }
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .credentials {
            background: rgba(76, 175, 80, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #4CAF50;
            text-align: center;
        }
        .countdown {
            font-size: 2em;
            text-align: center;
            margin: 20px 0;
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Corre√ß√£o Final - Sistema de Login</h1>
        
        <div class="credentials">
            <h3>üéØ Credenciais Corretas</h3>
            <strong>Username:</strong> Admin<br>
            <strong>Password:</strong> admin1<br>
            <strong>Hash:</strong> <span id="hash-display"></span>
        </div>

        <div class="countdown" id="countdown">Configura√ß√£o autom√°tica em 3 segundos...</div>
        
        <div class="status" id="status"></div>
        
        <div style="text-align: center;">
            <button onclick="configurarSistema()" id="config-btn">üîß Configurar Sistema</button>
            <button onclick="verificarSistema()" id="verify-btn">üîç Verificar Sistema</button>
            <button onclick="limparTudo()" id="clear-btn">üßπ Limpar Tudo</button>
            <button onclick="irParaLogin()" id="login-btn" style="background: linear-gradient(45deg, #2196F3, #1976D2);">üîê Ir para Login</button>
        </div>
    </div>

    <script>
        // Fun√ß√£o de hash exata do sistema
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        function log(message, type = 'info') {
            const statusElement = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : 
                              type === 'error' ? 'error' : 
                              type === 'warning' ? 'warning' : 'info';
            
            statusElement.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            statusElement.scrollTop = statusElement.scrollHeight;
            console.log(message);
        }

        function limparTudo() {
            // Limpar TODAS as poss√≠veis chaves do localStorage
            const chavesParaLimpar = [
                'secretary-users',
                'eetad_secretary_users',
                'secretary-session',
                'eetad_secretary_session'
            ];
            
            log('üßπ LIMPANDO TODOS OS DADOS ANTIGOS...', 'warning');
            
            chavesParaLimpar.forEach(chave => {
                if (localStorage.getItem(chave)) {
                    localStorage.removeItem(chave);
                    log(`   ‚úÖ Removido: ${chave}`, 'success');
                } else {
                    log(`   ‚ö™ N√£o encontrado: ${chave}`, 'info');
                }
            });
            
            log('üßπ LIMPEZA CONCLU√çDA!', 'success');
        }

        function configurarSistema() {
            log('üîß INICIANDO CONFIGURA√á√ÉO DO SISTEMA...', 'info');
            
            // 1. Limpar dados antigos
            limparTudo();
            
            // 2. Criar usu√°rio Admin com a chave correta
            const hashCorreto = hashPassword('admin1');
            const usuarioAdmin = {
                id: 'admin-001',
                username: 'Admin',
                email: 'admin@eetad.com',
                fullName: 'Administrador',
                role: 'admin',
                passwordHash: hashCorreto,
                createdAt: new Date().toISOString()
            };
            
            const usuarios = [usuarioAdmin];
            
            // Usar a chave correta: 'secretary-users'
            localStorage.setItem('secretary-users', JSON.stringify(usuarios));
            
            log('üë§ USU√ÅRIO ADMIN CRIADO:', 'success');
            log(`   Username: ${usuarioAdmin.username}`, 'info');
            log(`   Email: ${usuarioAdmin.email}`, 'info');
            log(`   Hash: ${usuarioAdmin.passwordHash}`, 'info');
            log(`   Chave: secretary-users`, 'info');
            
            // 3. Verificar se foi salvo corretamente
            const verificacao = localStorage.getItem('secretary-users');
            if (verificacao) {
                const usuariosVerificados = JSON.parse(verificacao);
                const adminEncontrado = usuariosVerificados.find(u => u.username === 'Admin');
                
                if (adminEncontrado && adminEncontrado.passwordHash === hashCorreto) {
                    log('‚úÖ VERIFICA√á√ÉO PASSOU - Admin configurado corretamente!', 'success');
                } else {
                    log('‚ùå VERIFICA√á√ÉO FALHOU - Problema na configura√ß√£o!', 'error');
                }
            } else {
                log('‚ùå VERIFICA√á√ÉO FALHOU - Dados n√£o foram salvos!', 'error');
            }
            
            log('üéâ CONFIGURA√á√ÉO CONCLU√çDA!', 'success');
            log('', 'info');
            log('üîê CREDENCIAIS PARA LOGIN:', 'success');
            log('   Username: Admin', 'success');
            log('   Password: admin1', 'success');
        }

        function verificarSistema() {
            log('üîç VERIFICANDO SISTEMA...', 'info');
            
            const usuarios = localStorage.getItem('secretary-users');
            const sessao = localStorage.getItem('secretary-session');
            
            log(`üìä STATUS DO LOCALSTORAGE:`, 'info');
            log(`   secretary-users: ${usuarios ? 'PRESENTE' : 'AUSENTE'}`, usuarios ? 'success' : 'error');
            log(`   secretary-session: ${sessao ? 'PRESENTE' : 'AUSENTE'}`, sessao ? 'success' : 'info');
            
            if (usuarios) {
                try {
                    const listaUsuarios = JSON.parse(usuarios);
                    log(`   Total de usu√°rios: ${listaUsuarios.length}`, 'info');
                    
                    const admin = listaUsuarios.find(u => u.username === 'Admin');
                    if (admin) {
                        const hashEsperado = hashPassword('admin1');
                        log(`   Admin encontrado: ‚úÖ`, 'success');
                        log(`   Hash armazenado: ${admin.passwordHash}`, 'info');
                        log(`   Hash esperado: ${hashEsperado}`, 'info');
                        log(`   Hashes coincidem: ${admin.passwordHash === hashEsperado ? '‚úÖ' : '‚ùå'}`, 
                            admin.passwordHash === hashEsperado ? 'success' : 'error');
                    } else {
                        log(`   Admin encontrado: ‚ùå`, 'error');
                    }
                } catch (e) {
                    log(`   Erro ao analisar dados: ${e.message}`, 'error');
                }
            }
            
            log('üîç VERIFICA√á√ÉO CONCLU√çDA!', 'info');
        }

        function irParaLogin() {
            window.location.href = '/secretaria';
        }

        // Configura√ß√£o autom√°tica
        let contadorRegressivo = 3;
        const countdownElement = document.getElementById('countdown');
        
        function atualizarContador() {
            if (contadorRegressivo > 0) {
                countdownElement.textContent = `Configura√ß√£o autom√°tica em ${contadorRegressivo} segundos...`;
                contadorRegressivo--;
                setTimeout(atualizarContador, 1000);
            } else {
                countdownElement.textContent = 'üöÄ Executando configura√ß√£o autom√°tica...';
                setTimeout(() => {
                    configurarSistema();
                    countdownElement.textContent = '‚úÖ Configura√ß√£o autom√°tica conclu√≠da!';
                    countdownElement.style.color = '#4CAF50';
                }, 500);
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            const hashEsperado = hashPassword('admin1');
            document.getElementById('hash-display').textContent = hashEsperado;
            
            log('üîß Sistema de corre√ß√£o carregado', 'info');
            log(`Hash esperado para "admin1": ${hashEsperado}`, 'info');
            
            // Iniciar contagem regressiva
            atualizarContador();
        });
    </script>
</body>
</html>