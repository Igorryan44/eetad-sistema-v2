<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Simples de Login</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .container { background: #f9f9f9; padding: 20px; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Teste Simples de Login</h1>
        
        <div>
            <h3>1. Resetar Sistema</h3>
            <button onclick="resetSystem()">ğŸ”„ Reset Completo</button>
            <div id="resetResult"></div>
        </div>

        <div>
            <h3>2. Testar Login</h3>
            <input type="text" id="username" placeholder="UsuÃ¡rio" value="Admin">
            <input type="password" id="password" placeholder="Senha" value="admin1">
            <button onclick="testLogin()">ğŸ” Testar</button>
            <div id="loginResult"></div>
        </div>

        <div>
            <h3>3. Status</h3>
            <button onclick="showStatus()">ğŸ“Š Mostrar Status</button>
            <div id="statusResult"></div>
        </div>
    </div>

    <script>
        // FunÃ§Ã£o de hash EXATA do authService
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32-bit integer
            }
            return Math.abs(hash).toString(16);
        }

        function resetSystem() {
            console.log('ğŸ”„ Resetando sistema...');
            
            // Limpar tudo
            localStorage.clear();
            
            // Criar usuÃ¡rio Admin
            const adminUser = {
                id: '1',
                username: 'Admin',
                email: 'admin@eetad.com',
                fullName: 'Administrador',
                passwordHash: hashPassword('admin1'),
                createdAt: new Date().toISOString(),
                status: 'ATIVO'
            };
            
            const users = [adminUser];
            localStorage.setItem('secretary-users', JSON.stringify(users));
            
            const result = `
                <div class="result success">
                    âœ… Sistema resetado!<br>
                    ğŸ‘¤ UsuÃ¡rio: Admin<br>
                    ğŸ”‘ Senha: admin1<br>
                    ğŸ” Hash: ${adminUser.passwordHash}
                </div>
            `;
            
            document.getElementById('resetResult').innerHTML = result;
            console.log('âœ… Reset completo!', adminUser);
        }

        function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            console.log(`ğŸ” Testando login: ${username} / ${password}`);
            
            // Buscar usuÃ¡rios
            const usersData = localStorage.getItem('secretary-users');
            if (!usersData) {
                document.getElementById('loginResult').innerHTML = '<div class="result error">âŒ Nenhum usuÃ¡rio encontrado! Execute o reset primeiro.</div>';
                return;
            }
            
            const users = JSON.parse(usersData);
            console.log('ğŸ‘¥ UsuÃ¡rios encontrados:', users);
            
            // Buscar usuÃ¡rio
            const user = users.find(u => u.username === username);
            if (!user) {
                document.getElementById('loginResult').innerHTML = '<div class="result error">âŒ UsuÃ¡rio nÃ£o encontrado!</div>';
                return;
            }
            
            // Testar senha
            const inputHash = hashPassword(password);
            console.log('ğŸ”‘ Hash da senha digitada:', inputHash);
            console.log('ğŸ” Hash armazenado:', user.passwordHash);
            
            if (user.passwordHash === inputHash) {
                // Criar sessÃ£o
                const session = {
                    user: user,
                    expiresAt: Date.now() + (8 * 60 * 60 * 1000) // 8 horas
                };
                localStorage.setItem('eetad_secretary_session', JSON.stringify(session));
                
                document.getElementById('loginResult').innerHTML = `
                    <div class="result success">
                        âœ… LOGIN SUCESSO!<br>
                        ğŸ‘¤ UsuÃ¡rio: ${user.fullName}<br>
                        ğŸ“§ Email: ${user.email}<br>
                        ğŸ• SessÃ£o criada atÃ©: ${new Date(session.expiresAt).toLocaleString()}
                    </div>
                `;
                console.log('âœ… Login bem-sucedido!', user);
            } else {
                document.getElementById('loginResult').innerHTML = `
                    <div class="result error">
                        âŒ SENHA INCORRETA!<br>
                        ğŸ”‘ Hash digitado: ${inputHash}<br>
                        ğŸ” Hash esperado: ${user.passwordHash}
                    </div>
                `;
                console.log('âŒ Senha incorreta!');
            }
        }

        function showStatus() {
            const usersData = localStorage.getItem('secretary-users');
            const sessionData = localStorage.getItem('eetad_secretary_session');
            
            let status = '<div class="result info">';
            
            if (usersData) {
                const users = JSON.parse(usersData);
                status += `ğŸ‘¥ UsuÃ¡rios: ${users.length}<br>`;
                users.forEach(user => {
                    status += `&nbsp;&nbsp;- ${user.username} (${user.email})<br>`;
                });
            } else {
                status += 'âŒ Nenhum usuÃ¡rio encontrado<br>';
            }
            
            if (sessionData) {
                const session = JSON.parse(sessionData);
                const isValid = session.expiresAt > Date.now();
                status += `ğŸ” SessÃ£o: ${isValid ? 'ATIVA' : 'EXPIRADA'}<br>`;
                status += `ğŸ‘¤ Logado como: ${session.user?.fullName || 'N/A'}<br>`;
                status += `â° Expira em: ${new Date(session.expiresAt).toLocaleString()}<br>`;
            } else {
                status += 'âŒ Nenhuma sessÃ£o ativa<br>';
            }
            
            status += '</div>';
            document.getElementById('statusResult').innerHTML = status;
        }

        // Mostrar status inicial
        window.onload = showStatus;
    </script>
</body>
</html>